---
import type { CollectionEntry } from "astro:content";
import PageLayout from "./PageLayout.astro";
import PostHero from "@/components/post/PostHero";

interface Props {
	post: CollectionEntry<"post">;
}

const { post } = Astro.props;
const {
	data: { title, description, ogImage, publishDate },
	slug,
} = post;
const socialImage = ogImage ?? `/og-image/${slug}.png`;
const articleDate = publishDate.toISOString();
const { headings } = await post.render();
---

<PageLayout meta={{ title, description, articleDate, ogImage: socialImage }}>
	<div class="mb-8">
		<a
			href="/posts"
			class="py-4 underline-offset-4 sm:py-0 sm:hover:underline"
			rel="prefetch"
		>
			‚Üê all posts
		</a>
	</div>
	<div class="gap-x-10 lg:flex lg:items-start">
		{
			!!headings.length && (
				<aside class="sticky top-20 order-2 -me-32 hidden basis-64 lg:block">
					<h2 class="font-semibold">Table of Contents</h2>
					<ul class="mt-4 text-xs">
						{headings.map(({ depth, slug, text }) => (
							<li class="line-clamp-2 hover:text-accent">
								<a
									class={`block ${
										depth <= 2 ? "mt-3" : "mt-2 ps-3 text-[0.6875rem]"
									}`}
									href={`#${slug}`}
									aria-label={`Scroll to section: ${text}`}
								>
									<span class="mr-1">{"#".repeat(depth)}</span>
									{text}
								</a>
							</li>
						))}
					</ul>
				</aside>
			)
		}
		<article class="flex-grow break-words">
			<div id="blog-hero">
				<PostHero content={post} />
			</div>
			<div
				class="prose prose-sm prose-cactus mt-12 prose-headings:font-semibold prose-headings:before:absolute prose-headings:before:-ms-4 prose-headings:before:text-accent prose-headings:before:content-['#'] prose-th:before:content-none"
			>
				<slot />
			</div>
		</article>
	</div>
</PageLayout>
